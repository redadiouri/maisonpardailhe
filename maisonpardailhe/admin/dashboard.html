<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Panel Admin - Maison Pardailhé</title>
  <link rel="stylesheet" href="css/admin-clean.css">
</head>
<body class="admin-bg">
  <div class="admin-dashboard-wrapper">
    <div class="admin-dashboard-card">
      <aside class="admin-sidebar">
        <h1>Panel Admin</h1>
        <div class="admin-tabs-vertical">
          <button class="tab-btn tab-btn-vertical active" data-tab="attente">Commandes en attente <span id="badge-attente" class="badge"></span></button>
          <button class="tab-btn tab-btn-vertical" data-tab="encours">Commandes en cours <span id="badge-encours" class="badge"></span></button>
          <button class="tab-btn tab-btn-vertical" data-tab="menus">Menus</button>
          <button class="tab-btn tab-btn-vertical" data-tab="admins">Administrateurs</button>
          <button class="tab-btn tab-btn-vertical" data-tab="stats">Statistiques</button>
        </div>
        <button id="logoutBtn" class="logout-btn">Déconnexion</button>

        <!-- Change password area -->
        <div class="admin-change-pwd" style="margin-top:1rem;">
          <button id="toggleChangePwd" class="btn ghost" aria-expanded="false" style="width:100%;">Changer le mot de passe</button>
          <form id="changePwdForm" style="display:none; margin-top:0.75rem; gap:0.5rem;" aria-hidden="true">
            <label for="currentPassword">Mot de passe actuel</label>
            <input id="currentPassword" name="currentPassword" type="password" autocomplete="current-password">

            <label for="newPassword">Nouveau mot de passe</label>
            <input id="newPassword" name="newPassword" type="password" autocomplete="new-password">

            <label for="confirmNewPassword">Confirmer le nouveau mot de passe</label>
            <input id="confirmNewPassword" name="confirmNewPassword" type="password" autocomplete="new-password">

            <div style="display:flex; gap:0.5rem; margin-top:0.5rem;">
              <button type="submit" id="changePwdBtn" class="btn primary" style="flex:1;">Enregistrer</button>
              <button type="button" id="cancelChangePwd" class="btn ghost" style="flex:1;">Annuler</button>
            </div>
            <div id="changePwdMsg" role="status" aria-live="polite" style="margin-top:0.5rem; color:#f33;"></div>
          </form>
        </div>
      </aside>
      <main class="admin-main">
        <div id="tab-attente" class="tab-content active">
          <h2>Commandes en attente</h2>
          <div id="attente-loader" class="loader" style="display:none;"></div>
          <div id="attente-list"></div>
        </div>
        <div id="tab-encours" class="tab-content">
          <h2>Commandes en cours</h2>
          <div id="encours-loader" class="loader" style="display:none;"></div>
          <div id="encours-list"></div>
        </div>
        <div id="tab-menus" class="tab-content">
          <h2>Menus</h2>
          <div style="display:flex; gap:1rem; align-items:center; margin-bottom:1rem;">
            <form id="menu-form" style="display:flex; gap:0.5rem; align-items:center; flex-wrap:wrap;">
              <input id="menu-name" placeholder="Nom" required>
              <input id="menu-price" type="number" min="0" placeholder="Prix (€)" step="0.01">
              <input id="menu-stock" type="number" min="0" placeholder="Stock" value="0">
              <input id="menu-description" placeholder="Description (court)" style="min-width:200px;">
              <label style="display:flex;align-items:center;gap:0.25rem;">
                <input id="menu-is-quote" type="checkbox">
                <span style="font-size:0.9rem;">Sur devis</span>
              </label>
              <label style="display:flex;align-items:center;gap:0.25rem;">
                <input id="menu-available" type="checkbox" checked>
                <span style="font-size:0.9rem;">Disponible</span>
              </label>
              <label style="display:flex;align-items:center;gap:0.25rem;">
                <input id="menu-visible" type="checkbox" checked>
                <span style="font-size:0.9rem;">Visible</span>
              </label>
              <button type="submit" class="btn primary">➕ Ajouter</button>
            </form>
            <div style="margin-left:auto; display:flex; gap:0.5rem; align-items:center;">
              <input id="menu-search" placeholder="Rechercher...">
              <button id="menu-refresh" class="btn">⟳</button>
            </div>
          </div>
          <div id="menu-table-container">
              <table id="menu-table" class="admin-table" style="width:100%; border-collapse:collapse;">
              <thead>
                <tr>
                  <th data-label="Nom">Nom</th>
                  <th data-label="Description">Description</th>
                  <th data-label="Prix">Prix</th>
                  <th data-label="Stock">Stock</th>
                  <th data-label="Sur devis">Sur devis</th>
                  <th data-label="Disponible">Disponible</th>
                  <th data-label="Visible">Visible</th>
                  <th data-label="Actions">Actions</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
        <div id="tab-admins" class="tab-content">
          <h2>Administrateurs</h2>
          <div style="display:flex; gap:1rem; align-items:center; margin-bottom:1rem;">
            <form id="admin-create-form" style="display:flex; gap:0.5rem; align-items:center; flex-wrap:wrap;">
              <input id="admin-username" placeholder="Nom d'utilisateur" required>
              <input id="admin-password" type="password" placeholder="Mot de passe (min 8)" required>
              <input id="admin-password-confirm" type="password" placeholder="Confirmer mot de passe" required>
              <label style="display:flex;align-items:center;gap:0.25rem;">
                <input id="admin-can-edit-menus" type="checkbox" checked>
                <span style="font-size:0.9rem;">Peut modifier les menus</span>
              </label>
              <button type="submit" class="btn primary">➕ Ajouter</button>
            </form>
            <div style="margin-left:auto;">
              <button id="admin-refresh" class="btn">⟳</button>
            </div>
          </div>
          <div id="admin-list-container">
            <table id="admin-table" class="admin-table" style="width:100%; border-collapse:collapse;">
              <thead><tr><th style="width:64px;">ID</th><th>Nom d'utilisateur</th><th>Peut modifier menus</th><th>Actions</th></tr></thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
        <div id="tab-stats" class="tab-content">
          <h2>Statistiques</h2>
          <div style="display:flex; gap:1rem; align-items:flex-start; margin-bottom:1rem;">
            <div class="stat-card" style="background:var(--card); padding:12px; border-radius:8px; min-width:160px;"> 
              <div style="font-size:0.85rem; color:var(--muted);">Commandes totales</div>
              <div id="stat-total-orders" style="font-size:1.25rem; font-weight:700;">—</div>
              <div style="font-size:0.75rem; color:var(--muted);">Derniers 30 jours: <span id="stat-last30">—</span></div>
            </div>
            <div class="stat-card" style="background:var(--card); padding:12px; border-radius:8px; min-width:220px;"> 
              <div style="font-size:0.85rem; color:var(--muted);">Répartition par statut</div>
              <div id="stat-by-status" style="margin-top:6px; font-size:0.95rem;">—</div>
            </div>
            <div class="stat-card" style="background:var(--card); padding:12px; border-radius:8px; min-width:200px; margin-left:auto; text-align:right;"> 
              <div style="font-size:0.85rem; color:var(--muted);">CA estimé</div>
              <div id="stat-revenue" style="font-size:1.25rem; font-weight:700;">—</div>
              <div style="font-size:0.75rem; color:var(--muted);">(basé sur menus.price_cents)</div>
            </div>
          </div>
          <div id="stat-items" style="margin-top:6px;">
            <h3>Articles vendus (données analytiques)</h3>
            <div id="stat-items-list" style="color:var(--muted);">—</div>
          </div>
          <div style="margin-top:12px; display:flex; gap:0.5rem; align-items:center;">
            <h3 style="margin:0;">Commandes: 30 derniers jours</h3>
            <button id="stat-export-csv" class="btn" style="margin-left:auto;">Export CSV</button>
          </div>
          <div style="margin-top:8px;">
            <canvas id="ordersChart" width="600" height="140" style="max-width:100%; height:auto;"></canvas>
          </div>
        </div>
        <!-- Stockage removed: functionality merged into Menus -->
      </main>
    </div>
  </div>
  <!-- Chart.js from CDN for simple charts in the admin panel -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="js/admin.js"></script>
</body>
</html>
